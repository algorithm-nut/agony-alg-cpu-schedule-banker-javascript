<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>banker.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/[banker-dom.js].html">[banker-dom.js]</a></li>
                                <li><a href="../classes/[banker.js].html">[banker.js]</a></li>
                                <li><a href="../classes/[common.js].html">[common.js]</a></li>
                                <li><a href="../classes/[cpu-dom.js].html">[cpu-dom.js]</a></li>
                                <li><a href="../classes/[cpu.js].html">[cpu.js]</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: banker.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * author [luo0412]
 * date [2016-12-21]
 * description [银行家算法的js代码]
 * @class [banker.js]
 * @constructor
 */

// 全局变量命名全部大写,用下划线连接
var PROGRESS_NUM = 0; // 进程数
var RESOURCE_NUM = 0; // 资源数

var MAX = [];
var ALLOCATION = [];
var AVAILABLE = [];
var AVAILABLE_COPY = []; // AVAILABLE的副本,用于需要更改的全局变量
var NEED = [];

var SAFE_SEQUENCE_ARR = []; // 安全序列数组
var SAFE_SEQUENCE_NUM = 0;  // 安全序列总数

var ORDER_STR = &quot;&quot;; // 如果有5个进程, 即为 &quot;01234&quot;
var POSS_ORDER_ARR = []; // 可能的安全序列数组，只是简单排列组合

var TEXTAREA_TXT; // 在textarea中输出执行过程


/**
 * @method [generateOrderStr]
 * @description [生成顺序字符串,用于生成POSS_ORDER_ARR]
 * @param  {[type]} num [description]
 * @return {[type]}     [description]
 */
function getOrderStr(num) {
    var str = &quot;&quot;;
    for(var i=0; i&lt;num; i++) {
        str += i;
    }
    return str;
}

/**
 * @method [generatePossOrderArr]
 * @description [递归生成POSS_ORDER_ARR]
 * @param  {[type]} s [description]
 * @return {[type]}   [description]
 * @example
 *     generatePossOrderArr(&quot;&quot;); // 返回整型二维数组
 */
function generatePossOrderArr(s) {
    for(var i=0,length = ORDER_STR.length; i&lt;length; i++) {
        // 最后输出, 只差一个元素的时候
        if(s.length == length - 1) {
            if(s.indexOf(ORDER_STR[i]) &lt; 0) {
                var tmpArr = (s + ORDER_STR[i]).split(&quot;&quot;);
                POSS_ORDER_ARR.push(arrParseInt(tmpArr)); // 转化成浮点型
            }
            continue;
        }

        // 递归，只要这个元素之前没有过，说明字符串长度还不够，要往上加
        if(s.indexOf(ORDER_STR[i]) &lt; 0) {
            generatePossOrderArr(s + ORDER_STR[i]);
        }
    }
}

/**
 * @method [resetGlobalVar]
 * @description [重置全局变量, 在初始化时调用]
 * @return {[type]} [description]
 */
function resetBankerGlobalVar() {
    PROGRESS_NUM = 0; // 进程数
    RESOURCE_NUM = 0; // 资源数

    SAFE_SEQUENCE_NUM = 0;
    SAFE_SEQUENCE_ARR = [];

    TEXTAREA_TXT = &quot;&quot;;

    MAX = [];
    ALLOCATION = [];
    AVAILABLE = [];
    AVAILABLE_COPY = [];
    NEED = [];

    ORDER_STR = [];
    POSS_ORDER_ARR = [];
}


/**
 * @method  [generateRandMaxAllocation]
 * @description [随机初始化MAX和ALLOCATION]
 * @return {[type]} [description]
 */
function generateRandMaxAllocation() {
    var tmpArr1 = [], tmpArr2 = []; // 用于临时存储
    var rand = 0;

    for(var i=0; i&lt;PROGRESS_NUM; i++) {
        tmpArr1 = [];
        tmpArr2 = [];
        for(var j=0; j&lt;RESOURCE_NUM; j++) {
            rand = getRandIntBetweenAB(0, 3);
            tmpArr1.push(rand);
            tmpArr2.push(rand + getRandIntBetweenAB(0, 6));
        }
        ALLOCATION.push(tmpArr1);
        MAX.push(tmpArr2);
    }
}


/**
 * @method [generateRandAvailable]
 * @description [随机初始化AVAILABLE]
 * @return {[type]} [description]
 */
function generateRandAvailable() {
    for(var i=0; i&lt;RESOURCE_NUM; i++) {
        AVAILABLE.push(getRandIntBetweenAB(0, 3));
    }
}


/**
 * @method [isNeedSafe]
 * @description [判断现有资源AVAILABLE_COPY是否小于某进程NEED]
 * @param  {[type]}  pos [description]
 * @return {Boolean}     [description]
 */
function isNeedSafe(pos) {
    for(var i=0; i&lt;RESOURCE_NUM; i++) {
        if(AVAILABLE_COPY[i] &lt; NEED[pos][i]) {
            return false;
        }
    }

    return true;
}


/**
 * @method [updateAvailableCopy]
 * @description [更新AVAILABLE_COPY]
 * @param  {[type]}  pos [description]
 * @return {Boolean}     [description]
 */
function updateAvailableCopy(pos) {
    for(var i=0; i&lt;RESOURCE_NUM; i++) {
        AVAILABLE_COPY[i] += ALLOCATION[pos][i]; // 不需要减去NEED,因为也会释放
    }
}


/**
 * @method [generateSafeSequence]
 * @description [计算所有安全序列]
 * @return {[type]} [description]
 */
function generateSafeSequence() {
    TEXTAREA_TXT = &quot;所有安全序列如下:\n&quot;; // 开始记录过程
    AVAILABLE_COPY = cloneArr(AVAILABLE);

    // 按照可能的顺序依次判断
    for(var i=0, len1=POSS_ORDER_ARR.length; i&lt;len1; i++) {
        for(var j=0, len2=PROGRESS_NUM; j&lt;len2; j++) {
            // 判断是否安全
            if(isNeedSafe(POSS_ORDER_ARR[i][j]) === false) {
                break;
            } else {
                updateAvailableCopy(POSS_ORDER_ARR[i][j]); // 暂时安全,更新AVAILABLE_COPY
            }

            // 形成一条安全序列
            if(j === PROGRESS_NUM - 1) {
                SAFE_SEQUENCE_NUM++;
                TEXTAREA_TXT += &quot;安全序列&quot; + SAFE_SEQUENCE_NUM + &quot;:  &quot; +
                          getExecOrderStr(POSS_ORDER_ARR[i]) + &quot;\n&quot;;
                SAFE_SEQUENCE_ARR.push(POSS_ORDER_ARR[i]);
            }
        }
        AVAILABLE_COPY = cloneArr(AVAILABLE);
    }
}
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
